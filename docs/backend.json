{
  "entities": {
    "Student": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Student",
      "type": "object",
      "description": "Represents a student user within the EduEase AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Student entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the student."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the student."
        },
        "email": {
          "type": "string",
          "description": "The email address of the student, used for communication.",
          "format": "email"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch the student is enrolled in. (Relationship: Batch 1:N Student)"
        },
        "enrollmentYear": {
          "type": "number",
          "description": "The academic year in which the student was enrolled."
        },
        "dateJoined": {
          "type": "string",
          "description": "The date and time when the student joined the application.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "batchId",
        "enrollmentYear",
        "dateJoined"
      ]
    },
    "Teacher": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Teacher",
      "type": "object",
      "description": "Represents a teacher user within the EduEase AI application, responsible for managing academic content.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Teacher entity."
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the teacher."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the teacher."
        },
        "email": {
          "type": "string",
          "description": "The email address of the teacher, used for communication.",
          "format": "email"
        },
        "subjectIds": {
          "type": "array",
          "description": "References to Subjects taught by this teacher. (Relationship: Teacher N:N Subject)",
          "items": {
            "type": "string"
          }
        },
        "batchIds": {
          "type": "array",
          "description": "References to Batches taught by this teacher. (Relationship: Teacher N:N Batch)",
          "items": {
            "type": "string"
          }
        },
        "dateJoined": {
          "type": "string",
          "description": "The date and time when the teacher joined the application.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "dateJoined"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Represents a group of students enrolled together for a specific academic period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the batch (e.g., '2023-Fall A')."
        },
        "year": {
          "type": "number",
          "description": "The academic year associated with the batch."
        },
        "description": {
          "type": "string",
          "description": "A brief description or additional details about the batch."
        }
      },
      "required": [
        "id",
        "name",
        "year"
      ]
    },
    "Subject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subject",
      "type": "object",
      "description": "Represents an academic subject or course offered in the institution.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subject entity."
        },
        "name": {
          "type": "string",
          "description": "The official name of the subject (e.g., 'Data Structures and Algorithms')."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the subject content or objectives."
        },
        "weightage": {
          "type": "number",
          "description": "The weightage of the subject, used for workload calculation and prioritization (e.g., credit hours or an arbitrary scale)."
        },
        "difficultyLevel": {
          "type": "number",
          "description": "The professor-assessed difficulty level of the subject, used by the AI prioritization tool (e.g., on a scale of 1-5)."
        }
      },
      "required": [
        "id",
        "name",
        "weightage",
        "difficultyLevel"
      ]
    },
    "Assessment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assessment",
      "type": "object",
      "description": "Represents various academic tasks such as assignments, projects, exams, or practicals.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Assessment entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the assessment (e.g., 'Assignment 1', 'Mid-Term Exam')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the assessment requirements and scope."
        },
        "type": {
          "type": "string",
          "description": "The type of assessment (e.g., 'Assignment', 'Project', 'Exam', 'Practical', 'Internal Assessment')."
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject this assessment belongs to. (Relationship: Subject 1:N Assessment)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch for which this assessment is applicable. (Relationship: Batch 1:N Assessment)"
        },
        "teacherId": {
          "type": "string",
          "description": "Reference to the Teacher who created or assigned this assessment. (Relationship: Teacher 1:N Assessment)"
        },
        "deadline": {
          "type": "string",
          "description": "The submission or due date and time for the assessment.",
          "format": "date-time"
        },
        "maxMarks": {
          "type": "number",
          "description": "The maximum possible marks or points for this assessment."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time when the assessment record was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The date and time when the assessment record was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "type",
        "subjectId",
        "batchId",
        "teacherId",
        "deadline",
        "maxMarks",
        "createdAt"
      ]
    },
    "Submission": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Submission",
      "type": "object",
      "description": "Records a student's submission for a particular assessment, including marks and feedback.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Submission entity."
        },
        "assessmentId": {
          "type": "string",
          "description": "Reference to the Assessment this submission is for. (Relationship: Assessment 1:N Submission)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the Student who made this submission. (Relationship: Student 1:N Submission)"
        },
        "submissionDate": {
          "type": "string",
          "description": "The date and time when the student submitted the assessment.",
          "format": "date-time"
        },
        "submittedContentUri": {
          "type": "string",
          "description": "A URI or link to the submitted content (e.g., file upload, external document).",
          "format": "uri"
        },
        "isLate": {
          "type": "boolean",
          "description": "Indicates whether the submission was made after the official deadline."
        },
        "grade": {
          "type": "number",
          "description": "The marks or grade obtained by the student for this submission. Can be null if not yet graded."
        },
        "feedback": {
          "type": "string",
          "description": "Feedback provided by the teacher on the submission."
        },
        "gradedByTeacherId": {
          "type": "string",
          "description": "Reference to the Teacher who graded this submission. (Relationship: Teacher 1:N Submission)"
        },
        "gradedAt": {
          "type": "string",
          "description": "The date and time when the submission was graded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "assessmentId",
        "studentId",
        "submissionDate",
        "isLate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/students/{studentId}",
        "definition": {
          "entityName": "Student",
          "schema": {
            "$ref": "#/backend/entities/Student"
          },
          "description": "Stores individual student profiles. The 'id' field matches the Firebase Authentication UID. Includes denormalized 'batchId' for authorization independence, allowing direct comparison in security rules.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the student, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/teachers/{teacherId}",
        "definition": {
          "entityName": "Teacher",
          "schema": {
            "$ref": "#/backend/entities/Teacher"
          },
          "description": "Stores individual teacher profiles. The 'id' field matches the Firebase Authentication UID. Includes denormalized 'batchIds' and 'subjectIds' for authorization independence, defining the teacher's scope of responsibility for security rules.",
          "params": [
            {
              "name": "teacherId",
              "description": "The unique identifier of the teacher, matching their Firebase Auth UID."
            }
          ]
        }
      },
      {
        "path": "/batches/{batchId}",
        "definition": {
          "entityName": "Batch",
          "schema": {
            "$ref": "#/backend/entities/Batch"
          },
          "description": "Stores details for academic batches. Access is determined by the 'batchId' in a student's profile or the 'batchIds' array in a teacher's profile. No specific denormalization needed within the batch document for authorization.",
          "params": [
            {
              "name": "batchId",
              "description": "The unique identifier for a specific academic batch."
            }
          ]
        }
      },
      {
        "path": "/subjects/{subjectId}",
        "definition": {
          "entityName": "Subject",
          "schema": {
            "$ref": "#/backend/entities/Subject"
          },
          "description": "Stores details for academic subjects. Access is determined by the 'subjectIds' array in a teacher's profile. No specific denormalization needed within the subject document for authorization.",
          "params": [
            {
              "name": "subjectId",
              "description": "The unique identifier for a specific academic subject."
            }
          ]
        }
      },
      {
        "path": "/assessments/{assessmentId}",
        "definition": {
          "entityName": "Assessment",
          "schema": {
            "$ref": "#/backend/entities/Assessment"
          },
          "description": "Stores details for assignments, projects, exams, etc. Includes 'teacherId', 'batchId', and 'subjectId' to facilitate authorization based on the creating teacher, and the target batch/subject. Students can read if their 'batchId' matches. Teachers can read/write if they are the creator or are authorized for the 'batchId' and 'subjectId'.",
          "params": [
            {
              "name": "assessmentId",
              "description": "The unique identifier for an assessment."
            }
          ]
        }
      },
      {
        "path": "/submissions/{submissionId}",
        "definition": {
          "entityName": "Submission",
          "schema": {
            "$ref": "#/backend/entities/Submission"
          },
          "description": "Records student submissions for assessments. Includes 'studentId', 'assessmentId', and 'gradedByTeacherId'. For authorization independence, denormalizes 'assessmentBatchId', 'assessmentSubjectId', and 'assessmentTeacherId' from the parent assessment to allow direct access checks without 'get()' on the assessment document.",
          "params": [
            {
              "name": "submissionId",
              "description": "The unique identifier for a student's submission."
            }
          ]
        }
      }
    ],
    "reasoning": "The recommended Firestore structure is designed to be highly secure, scalable, and debuggable by strictly adhering to the provided core design principles and strategy mandates. The design prioritizes Authorization Independence, ensuring that security rules avoid complex, expensive, or unreliable cross-document lookups for authorization. This is achieved through strategic denormalization and structural segregation.\n\n**Authorization Independence & Denormalization:**\n1.  **User Profiles (`/students/{studentId}`, `/teachers/{teacherId}`):** Student and Teacher profiles are stored in their own top-level collections. Critically, these documents store the user's authorization-relevant attributes directly: `batchId` for Students, and `batchIds` and `subjectIds` for Teachers. This allows rules to retrieve the current user's own authorization scope (e.g., `get(/students/$(request.auth.uid)).data.batchId`) without relying on custom claims or fetching attributes from other domain entities, thereby satisfying the DBAC principle.\n2.  **Assessment and Submission Context Denormalization:**\n    *   `Assessments` (`/assessments/{assessmentId}`): While a top-level collection, each `Assessment` document already includes `teacherId` (creator), `batchId` (target batch), and `subjectId` (target subject). These fields, combined with the user's profile attributes, provide sufficient context for authorization without requiring `get()` calls to related `Batch` or `Subject` documents. For example, a student can read an assessment if their `batchId` (from their own user profile) matches `resource.data.batchId`.\n    *   `Submissions` (`/submissions/{submissionId}`): This is where significant denormalization occurs to achieve true Authorization Independence. Each `Submission` document includes not only its `studentId` and `gradedByTeacherId`, but also copies of the relevant `assessmentBatchId`, `assessmentSubjectId`, and `assessmentTeacherId` from the `Assessment` it belongs to. This crucial denormalization ensures that rules can authorize read/write access to a `Submission` *without performing a `get()` call on the parent `Assessment` document*. This makes rule evaluation atomic, robust, and easier to debug, directly addressing the critical mandate to avoid hierarchical authorization dependencies.\n\n**Structural Segregation & QAPs (Rules are not Filters):**\n1.  **Top-Level Collections:** `Students`, `Teachers`, `Batches`, `Subjects`, `Assessments`, and `Submissions` are all top-level collections. This ensures each collection has a homogeneous security posture and simplifies rules by avoiding conditional logic based on document types within a single collection.\n2.  **Efficient List Operations:** The structure enables secure and efficient `list` operations (QAPs):\n    *   Students can securely `list` their own submissions by querying `submissions` where `studentId == request.auth.uid`.\n    *   Students can securely `list` `Assessments` applicable to them by querying `assessments` where `batchId == get(/students/$(request.auth.uid)).data.batchId`. The security rule would enforce that the queried `batchId` matches the student's actual `batchId`.\n    *   Teachers can securely `list` `Assessments` they manage or `Submissions` for assessments in their assigned batches/subjects by querying with `teacherId`, `batchId`, and `subjectId` filters, with rules checking these against the teacher's profile attributes (e.g., `resource.data.batchId in get(/teachers/$(request.auth.uid)).data.batchIds`). The denormalized `assessmentBatchId` and `assessmentSubjectId` in `Submission` documents are key here.\n\nThe error \"auth/unauthorized-domain\" mentioned by the user is a Firebase Authentication configuration issue related to authorized domains in the Firebase project settings, not a Firestore data structure problem. It requires attention in the Firebase console rather than a data model adjustment."
  }
}