{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EduEase AI application, linking to an external authentication provider and defining basic profile information and role.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "externalAuthId": {
          "type": "string",
          "description": "Unique identifier provided by the external authentication system (e.g., Google ID). This links the application's user profile to the external identity provider. (Relationship: External Auth Provider 1:1 User)"
        },
        "email": {
          "type": "string",
          "description": "The email address associated with the user's external authentication, used for identification and communication.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "role": {
          "type": "string",
          "description": "The role of the user within the application (e.g., 'student' or 'teacher')."
        }
      },
      "required": [
        "id",
        "externalAuthId",
        "email",
        "firstName",
        "lastName",
        "role"
      ]
    },
    "StudentProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StudentProfile",
      "type": "object",
      "description": "Stores specific profile details for a student user within the EduEase AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the StudentProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User entity. (Relationship: User 1:1 StudentProfile)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch the student belongs to. (Relationship: Batch 1:N StudentProfile)"
        },
        "academicYear": {
          "type": "number",
          "description": "The academic year the student is currently enrolled in."
        }
      },
      "required": [
        "id",
        "userId",
        "batchId",
        "academicYear"
      ]
    },
    "TeacherProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TeacherProfile",
      "type": "object",
      "description": "Stores specific profile details for a teacher user within the EduEase AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TeacherProfile entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the associated User entity. (Relationship: User 1:1 TeacherProfile)"
        },
        "subjectIds": {
          "type": "array",
          "description": "References to the Subjects taught by this teacher. (Relationship: TeacherProfile N:N Subject)",
          "items": {
            "type": "string"
          }
        },
        "batchIds": {
          "type": "array",
          "description": "References to the Batches managed by this teacher. (Relationship: TeacherProfile N:N Batch)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "subjectIds",
        "batchIds"
      ]
    },
    "Batch": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Batch",
      "type": "object",
      "description": "Represents a group of students, typically for a specific academic year or program.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Batch entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the batch (e.g., 'Computer Science 2023-A')."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the batch."
        },
        "academicYear": {
          "type": "number",
          "description": "The primary academic year associated with this batch."
        }
      },
      "required": [
        "id",
        "name",
        "academicYear"
      ]
    },
    "Subject": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subject",
      "type": "object",
      "description": "Defines an academic subject, including properties relevant for workload calculation and prioritization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Subject entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the subject (e.g., 'Mathematics', 'Data Structures')."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the subject."
        },
        "weightage": {
          "type": "number",
          "description": "The weightage of the subject, used for calculating student workload and prioritization. (e.g., 1-10 scale)."
        },
        "difficultyLevel": {
          "type": "string",
          "description": "Professor-assessed difficulty level of the subject (e.g., 'easy', 'medium', 'hard', or a numeric scale converted to string)."
        },
        "batchIds": {
          "type": "array",
          "description": "References to the Batches that are offered this subject. (Relationship: Subject N:N Batch)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "weightage",
        "difficultyLevel"
      ]
    },
    "Assignment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Assignment",
      "type": "object",
      "description": "Details about an academic assignment given to students.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Assignment entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the assignment."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the assignment."
        },
        "deadline": {
          "type": "string",
          "description": "The submission deadline for the assignment.",
          "format": "date-time"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject this assignment belongs to. (Relationship: Subject 1:N Assignment)"
        },
        "assignedByTeacherId": {
          "type": "string",
          "description": "Reference to the TeacherProfile who created/assigned this assignment. (Relationship: TeacherProfile 1:N Assignment)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch for which this assignment is intended. (Relationship: Batch 1:N Assignment)"
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time when the assignment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "deadline",
        "subjectId",
        "assignedByTeacherId",
        "batchId",
        "creationDate"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Details about an academic project assigned to students.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Project entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the project."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the project."
        },
        "deadline": {
          "type": "string",
          "description": "The submission deadline for the project.",
          "format": "date-time"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject this project belongs to. (Relationship: Subject 1:N Project)"
        },
        "assignedByTeacherId": {
          "type": "string",
          "description": "Reference to the TeacherProfile who created/assigned this project. (Relationship: TeacherProfile 1:N Project)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch for which this project is intended. (Relationship: Batch 1:N Project)"
        },
        "updates": {
          "type": "array",
          "description": "An array of strings, each representing an update or status change for the project. Each string should ideally include a timestamp.",
          "items": {
            "type": "string"
          }
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time when the project was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "deadline",
        "subjectId",
        "assignedByTeacherId",
        "batchId",
        "creationDate"
      ]
    },
    "Exam": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Exam",
      "type": "object",
      "description": "Details about an academic examination or practical session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Exam entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the exam (e.g., 'Mid-term Exam', 'Final Practical')."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the exam."
        },
        "examDate": {
          "type": "string",
          "description": "The scheduled date and time for the exam.",
          "format": "date-time"
        },
        "durationMinutes": {
          "type": "number",
          "description": "The duration of the exam in minutes."
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject this exam covers. (Relationship: Subject 1:N Exam)"
        },
        "batchId": {
          "type": "string",
          "description": "Reference to the Batch for which this exam is intended. (Relationship: Batch 1:N Exam)"
        },
        "assignedByTeacherId": {
          "type": "string",
          "description": "Reference to the TeacherProfile who scheduled this exam. (Relationship: TeacherProfile 1:N Exam)"
        }
      },
      "required": [
        "id",
        "title",
        "examDate",
        "durationMinutes",
        "subjectId",
        "batchId",
        "assignedByTeacherId"
      ]
    },
    "InternalAssessment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "InternalAssessment",
      "type": "object",
      "description": "Records the marks or grades for a student's internal assessment in a specific subject.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the InternalAssessment entity."
        },
        "title": {
          "type": "string",
          "description": "The title or type of assessment (e.g., 'Quiz 1', 'Mid-term')."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the assessment."
        },
        "maxMarks": {
          "type": "number",
          "description": "The maximum possible marks for this assessment."
        },
        "marksObtained": {
          "type": "number",
          "description": "The marks obtained by the student in this assessment."
        },
        "studentId": {
          "type": "string",
          "description": "Reference to the StudentProfile who received these marks. (Relationship: StudentProfile 1:N InternalAssessment)"
        },
        "subjectId": {
          "type": "string",
          "description": "Reference to the Subject for which this assessment was given. (Relationship: Subject 1:N InternalAssessment)"
        },
        "assessedByTeacherId": {
          "type": "string",
          "description": "Reference to the TeacherProfile who assessed and provided these marks. (Relationship: TeacherProfile 1:N InternalAssessment)"
        },
        "assessmentDate": {
          "type": "string",
          "description": "The date and time when the assessment was conducted or recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "maxMarks",
        "marksObtained",
        "studentId",
        "subjectId",
        "assessedByTeacherId",
        "assessmentDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Root collection for user profiles, where 'userId' corresponds to the Firebase Authentication UID. The 'id' field within the document should match 'userId'. Includes a 'role' field (e.g., 'student', 'teacher') for basic authorization contexts.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, corresponding to Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/studentProfile",
        "definition": {
          "entityName": "StudentProfile",
          "schema": {
            "$ref": "#/backend/entities/StudentProfile"
          },
          "description": "Subcollection storing specific profile details for a student user. The document ID of the student profile will be the 'userId' from its parent. This is strictly owned by the respective user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the parent User, corresponding to the student's Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/teacherProfile",
        "definition": {
          "entityName": "TeacherProfile",
          "schema": {
            "$ref": "#/backend/entities/TeacherProfile"
          },
          "description": "Subcollection storing specific profile details for a teacher user. The document ID of the teacher profile will be the 'userId' from its parent. This is strictly owned by the respective user and includes 'subjectIds' and 'batchIds' to define the teacher's scope for authorization.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the parent User, corresponding to the teacher's Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/batches/{batchId}",
        "definition": {
          "entityName": "Batch",
          "schema": {
            "$ref": "#/backend/entities/Batch"
          },
          "description": "Top-level collection representing academic batches or groups of students. Includes denormalized 'managerTeacherIds' (an array of teacher UIDs) within each document for authorization independence, indicating which teachers can manage this batch.",
          "params": [
            {
              "name": "batchId",
              "description": "The unique identifier for the batch."
            }
          ]
        }
      },
      {
        "path": "/subjects/{subjectId}",
        "definition": {
          "entityName": "Subject",
          "schema": {
            "$ref": "#/backend/entities/Subject"
          },
          "description": "Top-level collection defining academic subjects. Includes denormalized 'teachingTeacherIds' (an array of teacher UIDs) within each document for authorization independence, indicating which teachers teach this subject.",
          "params": [
            {
              "name": "subjectId",
              "description": "The unique identifier for the subject."
            }
          ]
        }
      },
      {
        "path": "/batches/{batchId}/assignments/{assignmentId}",
        "definition": {
          "entityName": "Assignment",
          "schema": {
            "$ref": "#/backend/entities/Assignment"
          },
          "description": "Subcollection for assignments, nested under the relevant batch. Includes 'assignedByTeacherId' and 'batchId' (matching the parent 'batchId') for authorization independence, clearly indicating who assigned it and for which batch.",
          "params": [
            {
              "name": "batchId",
              "description": "The unique identifier of the parent Batch."
            },
            {
              "name": "assignmentId",
              "description": "The unique identifier for the assignment."
            }
          ]
        }
      },
      {
        "path": "/batches/{batchId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Subcollection for academic projects, nested under the relevant batch. Includes 'assignedByTeacherId' and 'batchId' (matching the parent 'batchId') for authorization independence.",
          "params": [
            {
              "name": "batchId",
              "description": "The unique identifier of the parent Batch."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/batches/{batchId}/exams/{examId}",
        "definition": {
          "entityName": "Exam",
          "schema": {
            "$ref": "#/backend/entities/Exam"
          },
          "description": "Subcollection for academic examinations, nested under the relevant batch. Includes 'assignedByTeacherId' and 'batchId' (matching the parent 'batchId') for authorization independence.",
          "params": [
            {
              "name": "batchId",
              "description": "The unique identifier of the parent Batch."
            },
            {
              "name": "examId",
              "description": "The unique identifier for the exam."
            }
          ]
        }
      },
      {
        "path": "/users/{studentId}/internalAssessments/{assessmentId}",
        "definition": {
          "entityName": "InternalAssessment",
          "schema": {
            "$ref": "#/backend/entities/InternalAssessment"
          },
          "description": "Subcollection for internal assessment records, nested under the owning student's profile. Includes 'studentId' (matching the parent 'studentId'), 'assessedByTeacherId', 'batchId', and 'subjectId' for authorization independence, enabling direct checks for student ownership and teacher assessment scope.",
          "params": [
            {
              "name": "studentId",
              "description": "The unique identifier of the parent Student User, corresponding to the student's Firebase Authentication UID."
            },
            {
              "name": "assessmentId",
              "description": "The unique identifier for the internal assessment record."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{adminId}",
        "definition": {
          "entityName": "AdminRole",
          "schema": {
            "$ref": "#/backend/entities/AdminRole"
          },
          "description": "A collection to store existence-based global administrator roles, where 'adminId' is the Firebase Authentication UID of the administrator. The mere existence of a document at this path grants global admin privileges, adhering to the 'Existence over Content' DBAC principle for global roles. (Note: AdminRole schema is implicit, typically just containing an ID and timestamp).",
          "params": [
            {
              "name": "adminId",
              "description": "The unique identifier for the user who holds the global administrator role, corresponding to Firebase Authentication UID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure for EduEase AI is designed following the core principles of Authorization Independence, Structural Segregation, consistent Access Modeling, and Data Clarity to ensure security, scalability, and debuggability. \n\n**Authorization Independence:** This is achieved through strategic denormalization and careful path design. For entities like 'Batch' and 'Subject' which are shared across many users but managed by specific teachers, denormalized arrays like `managerTeacherIds` (in Batch) and `teachingTeacherIds` (in Subject) are embedded directly within the documents. This allows Firestore security rules to validate write access (e.g., 'only a teacher listed in `managerTeacherIds` can modify this Batch') without performing expensive and potentially non-atomic `get()` operations on other collections. For documents representing specific academic tasks like 'Assignment', 'Project', 'Exam', and 'InternalAssessment', the `assignedByTeacherId` or `assessedByTeacherId` and `batchId`/`subjectId` are directly included. This ensures that the document itself contains the necessary context for ownership and scope.\n\nCrucially, the design interprets the 'AVOID hierarchical authorization dependencies (get())' mandate to primarily refer to `get()` calls on *parent* documents in a hierarchical path (e.g., `get('/parent/{parentId}')` to authorize `/parent/{parentId}/child/{childId}`). However, `get()` operations on the *authenticated user's own profile documents* (e.g., `get('/users/$(request.auth.uid)/teacherProfile')`) for establishing their *capabilities or scope* (such as `batchIds` or `subjectIds` they manage/teach) are deemed acceptable. This controlled use of `get()` is vital for implementing robust `DBAC` (Database-Backed Access Control) where roles and permissions are stored in Firestore without custom claims, and enables dynamic scope validation without massive over-denormalization across many documents. This ensures that teachers can only modify data for the batches and subjects they are actually associated with, as defined in their `teacherProfile`.\n\n**QAPs (Rules are not Filters):** The structure facilitates Query-Allowed Paths for secure `list` operations. \n*   **User-Owned Data:** User profiles (`StudentProfile`, `TeacherProfile`) and `InternalAssessment` records are nested under `/users/{userId}`. This makes it trivial for rules to allow users to list their own data (`allow list: if request.auth.uid == userId;`). \n*   **Batch/Subject-Scoped Data:** Assignments, Projects, and Exams are nested under `/batches/{batchId}/...`. This allows students to securely list all relevant items for their `batchId` by simply querying that path, with rules ensuring their `studentProfile.batchId` matches the path's `batchId`. Teachers can also list items for batches they manage, with rules verifying their `teacherProfile.batchIds` or the `managerTeacherIds` field within the 'Batch' document itself.\n*   **Shared Data:** 'Batch' and 'Subject' collections are top-level, containing denormalized `managerTeacherIds` and `teachingTeacherIds` respectively. This allows QAPs for teachers to retrieve lists of batches/subjects they manage/teach efficiently via queries filtered on these denormalized fields.\n\n**Structural Segregation:** Different security postures are handled by separate collections or subcollections. For instance, `StudentProfile` and `TeacherProfile` are distinct subcollections under `/users/{userId}` reflecting their different fields and access patterns. Global administrator roles are handled by an 'existence-based' document in `/roles_admin/{adminId}`, clearly segregating this highly privileged access from regular user roles defined in `User.role`.\n\n**Access Modeling:** Path-based ownership (`/users/{userId}/...`), hierarchical paths for 1:N relationships (`/batches/{batchId}/assignments/{assignmentId}`), and membership maps (`managerTeacherIds`, `teachingTeacherIds`) are consistently applied. Global roles use the explicit `/roles_admin/{adminId}` collection."
  }
}